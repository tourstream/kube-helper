sudo: false
language: go
matrix:
  include:
    - os: linux
      go: 1.8.x

go_import_path: kube-helper

before_install:
  - go get -u github.com/golang/dep
  - go install github.com/golang/dep/cmd/dep
install:
  - mkdir -p ~/.config/gcloud
  - echo $APP_DEFAULT_CRED | base64 --decode >> ~/.config/gcloud/application_default_credentials.json
  - dep ensure
  - go get github.com/mattn/goveralls github.com/modocache/gover

before_script:
  - PKGS=$(go list ./... | grep -v /vendor/ | grep -v mocks )

script:
  - go build
  - go vet $PKGS
  - go list -f '{{if len .TestGoFiles}}"go test -coverprofile={{.Dir}}/.coverprofile {{.ImportPath}}"{{end}}' $PKGS | xargs -L 1 sh -c
  - gover
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then goveralls -coverprofile=gover.coverprofile -service=travis-ci -repotoken $COVERALLS_TOKEN; fi